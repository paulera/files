#!/bin/bash

CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

if [ "${CURRENT_BRANCH}" = "" ]; then
    echo "Not a git repo"
    exit 1
fi

COMPARE_BRANCH="main"

if [ ! -z "$1" ]; then
    COMPARE_BRANCH="$1"
fi

echo "Comparing the state of ${CURRENT_BRANCH} in relation to ${COMPARRE_BRANCH}"

echo ""

echo "after   behind"
git rev-list --left-right --count ${COMPARE_BRANCH}..${CURRENT_BRANCH}

echo ""

git rev-list --left-right --pretty=oneline ${COMPARE_BRANCH}..${CURRENT_BRANCH} \
    | sed "s/^>\(.*\)$/$(printf "\033[1;31m")behind > \1$(printf "\033[0m")/g" \
    | sed "s/^<\(.*\)$/$(printf "\033[1;32m")after  < \1$(printf "\033[0m")/g"

